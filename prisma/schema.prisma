// 3PL Asset Tracker MVP â€” Schema matches DATABASE-SCHEMA.md exactly.
// No extra tables or fields.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users       User[]
  assetTypes  AssetType[]
  clients     Client[]
  warehouses  Warehouse[]
  assets      Asset[]
}

model User {
  id             Int      @id @default(autoincrement())
  organizationId Int     @map("organization_id")
  email          String
  passwordHash    String  @map("password_hash")
  role           String  // "admin" | "user"
  fullName       String? @map("full_name")
  isActive       Boolean @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  assetsHistory AssetHistory[]

  @@unique([organizationId, email])
}

model AssetType {
  id             Int      @id @default(autoincrement())
  organizationId Int      @map("organization_id")
  name           String
  code           String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  assets       Asset[]
}

model Client {
  id             Int      @id @default(autoincrement())
  organizationId Int      @map("organization_id")
  name           String
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  assets       Asset[]
}

model Warehouse {
  id             Int      @id @default(autoincrement())
  organizationId Int      @map("organization_id")
  name           String
  code           String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  zones        Zone[]
  assets       Asset[]
}

model Zone {
  id          Int      @id @default(autoincrement())
  warehouseId Int      @map("warehouse_id")
  name        String
  code        String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  warehouse Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Restrict)
  assets    Asset[]
}

model Asset {
  id             Int      @id @default(autoincrement())
  organizationId Int      @map("organization_id")
  assetTypeId    Int      @map("asset_type_id")
  clientId       Int?     @map("client_id")
  warehouseId    Int?     @map("warehouse_id")
  zoneId        Int?     @map("zone_id")
  labelId        String   @map("label_id")
  status         String   // "in_use" | "idle" | "damaged" | "lost"
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  assetType    AssetType    @relation(fields: [assetTypeId], references: [id], onDelete: Restrict)
  client       Client?      @relation(fields: [clientId], references: [id], onDelete: Restrict)
  warehouse    Warehouse?   @relation(fields: [warehouseId], references: [id], onDelete: Restrict)
  zone         Zone?       @relation(fields: [zoneId], references: [id], onDelete: Restrict)
  history      AssetHistory[]

  @@unique([organizationId, labelId])
}

model AssetHistory {
  id        Int      @id @default(autoincrement())
  assetId   Int      @map("asset_id")
  userId    Int      @map("user_id")
  changedAt DateTime @map("changed_at")
  snapshot  Json

  asset Asset @relation(fields: [assetId], references: [id], onDelete: Restrict)
  user  User  @relation(fields: [userId], references: [id], onDelete: Restrict)
}
